<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0"
    />
    <title>Microphone Test - Podium Pal</title>
    <style>
      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana,
          sans-serif;
        background: linear-gradient(
          135deg,
          #667eea 0%,
          #764ba2 100%
        );
        color: white;
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
        margin: 0;
        padding: 20px;
      }
      .container {
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
        border-radius: 20px;
        padding: 40px;
        max-width: 600px;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
      }
      h1 {
        margin-top: 0;
        font-size: 2em;
      }
      button {
        background: white;
        color: #667eea;
        border: none;
        padding: 15px 30px;
        font-size: 1.1em;
        border-radius: 50px;
        cursor: pointer;
        font-weight: bold;
        margin: 10px 5px;
        transition: transform 0.2s;
      }
      button:hover {
        transform: scale(1.05);
      }
      button:active {
        transform: scale(0.95);
      }
      button.recording {
        background: #ff6b6b;
        color: white;
        animation: pulse 1s infinite;
      }
      @keyframes pulse {
        0%,
        100% {
          box-shadow: 0 0 20px rgba(255, 107, 107, 0.5);
        }
        50% {
          box-shadow: 0 0 40px rgba(255, 107, 107, 0.8);
        }
      }
      #transcript {
        background: rgba(0, 0, 0, 0.3);
        padding: 20px;
        border-radius: 10px;
        min-height: 100px;
        margin: 20px 0;
        line-height: 1.6;
      }
      .status {
        font-size: 0.9em;
        opacity: 0.8;
        margin-top: 10px;
      }
      .error {
        color: #ff6b6b;
        font-weight: bold;
      }
      .success {
        color: #51cf66;
        font-weight: bold;
      }
      .info {
        background: rgba(255, 255, 255, 0.2);
        padding: 15px;
        border-radius: 10px;
        margin: 15px 0;
        font-size: 0.9em;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>üé§ Microphone Test</h1>
      <p>
        Test if your browser can hear you before using
        Podium Pal
      </p>

      <div class="info">
        <strong>Instructions:</strong><br />
        1. Click "Start Test"<br />
        2. Allow microphone access when prompted<br />
        3. Speak clearly: "Testing one two three"<br />
        4. Your words should appear below
      </div>

      <button id="testBtn" onclick="toggleTest()">
        Start Test
      </button>
      <button onclick="clearTranscript()">Clear</button>

      <div id="transcript">
        Your speech will appear here...
      </div>

      <div id="status" class="status"></div>
    </div>

    <script>
      let recognition = null;
      let isRecording = false;
      let finalTranscript = "";

      const SpeechRecognition =
        window.SpeechRecognition ||
        window.webkitSpeechRecognition;

      if (!SpeechRecognition) {
        document.getElementById("status").innerHTML =
          '<span class="error">‚ùå Speech Recognition not supported in this browser. Please use Chrome or Edge.</span>';
        document.getElementById("testBtn").disabled = true;
      } else {
        recognition = new SpeechRecognition();
        recognition.continuous = true;
        recognition.interimResults = true;
        recognition.lang = "en-US";

        recognition.onstart = () => {
          document.getElementById("status").innerHTML =
            '<span class="success">‚úì Microphone active - speak now!</span>';
          console.log("Recognition started");
        };

        recognition.onresult = (event) => {
          let interimTranscript = "";

          for (
            let i = event.resultIndex;
            i < event.results.length;
            i++
          ) {
            const transcript =
              event.results[i][0].transcript;
            if (event.results[i].isFinal) {
              finalTranscript += transcript + " ";
            } else {
              interimTranscript += transcript;
            }
          }

          document.getElementById("transcript").innerHTML =
            "<strong>Final:</strong> " +
            (finalTranscript || "(none yet)") +
            "<br><br>" +
            "<em>Interim:</em> " +
            (interimTranscript || "(listening...)");

          console.log(
            "Received:",
            interimTranscript || finalTranscript
          );
        };

        recognition.onerror = (event) => {
          console.error("Recognition error:", event.error);
          document.getElementById(
            "status"
          ).innerHTML = `<span class="error">‚ùå Error: ${event.error}</span>`;

          if (event.error === "not-allowed") {
            alert(
              "Microphone access denied! Please allow microphone access in your browser settings."
            );
          }
        };

        recognition.onend = () => {
          console.log("Recognition ended");
          if (isRecording) {
            document.getElementById("status").innerHTML =
              '<span class="error">‚ö†Ô∏è Recognition stopped unexpectedly</span>';
          } else {
            document.getElementById("status").innerHTML =
              '<span class="success">‚úì Test complete</span>';
          }
          isRecording = false;
          document
            .getElementById("testBtn")
            .classList.remove("recording");
          document.getElementById("testBtn").textContent =
            "Start Test";
        };
      }

      function toggleTest() {
        if (!isRecording) {
          finalTranscript = "";
          isRecording = true;
          document
            .getElementById("testBtn")
            .classList.add("recording");
          document.getElementById("testBtn").textContent =
            "‚èπÔ∏è Stop Test";
          document.getElementById("status").innerHTML =
            "Starting...";

          try {
            recognition.start();
          } catch (e) {
            console.error("Failed to start:", e);
            document.getElementById("status").innerHTML =
              '<span class="error">‚ùå Failed to start: ' +
              e.message +
              "</span>";
            isRecording = false;
          }
        } else {
          isRecording = false;
          recognition.stop();
          document.getElementById("testBtn").textContent =
            "Start Test";
          document
            .getElementById("testBtn")
            .classList.remove("recording");
        }
      }

      function clearTranscript() {
        finalTranscript = "";
        document.getElementById("transcript").textContent =
          "Your speech will appear here...";
        document.getElementById("status").textContent = "";
      }
    </script>
  </body>
</html>
